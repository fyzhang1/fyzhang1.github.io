function handleThemeTransition(e,t=!0,o=1e3){document.documentElement.classList.add("theme-transition"),forceStylingForSpecificElements(e),document.documentElement.setAttribute("data-theme",e);const n=document.getElementById("theme-toggle");n&&(n.innerHTML="dark"===e?'<i class="fas fa-sun"></i>':'<i class="fas fa-moon"></i>'),t&&localStorage.setItem("theme",e),setTimeout((()=>{document.documentElement.classList.remove("theme-transition")}),o)}function initThemeToggle(){const e=document.getElementById("theme-toggle");if(!e)return;handleThemeTransition(localStorage.getItem("theme")||"light",!1),e.addEventListener("click",(function(){handleThemeTransition("dark"===(document.documentElement.getAttribute("data-theme")||"light")?"light":"dark")}));const t=window.matchMedia("(prefers-color-scheme: dark)");!localStorage.getItem("theme")&&t.matches&&handleThemeTransition("dark"),t.addEventListener("change",(e=>{localStorage.getItem("theme")||handleThemeTransition(e.matches?"dark":"light",!1)}))}function forceStylingForSpecificElements(e){const t="dark"===e?"#f0f0f0":"#333",o={authorsList:document.querySelector(".publication-authors:not(.affiliations)"),affiliations:document.querySelector(".publication-authors.affiliations"),cofirstAuthors:document.querySelector(".is-size-6.cofirst")};o.authorsList&&applyColorToElementAndChildren(o.authorsList,t),o.affiliations&&applyColorToElementAndChildren(o.affiliations,t),o.cofirstAuthors&&(o.cofirstAuthors.style.color=t)}function applyColorToElementAndChildren(e,t){e.style.color=t,Array.from(e.children).forEach((e=>{applyColorToElementAndChildren(e,t)}))}function debounce(e,t){let o;return function(){const n=this,i=arguments;clearTimeout(o),o=setTimeout((function(){e.apply(n,i)}),t)}}function initializeLightbox(){function e(){u=1,m=0,h=0,t()}function t(){n.style.transform=`translate(${m}px, ${h}px) scale(${u})`}const o=document.getElementById("lightbox"),n=document.getElementById("lightbox-image"),i=document.getElementById("lightbox-caption"),s=document.getElementById("lightbox-close"),c=document.querySelectorAll(".img-container img");if(!(o&&n&&i&&s))return;let l,a,r,d,u=1,m=0,h=0;c.forEach((t=>{t.addEventListener("click",(function(){n.src=this.src,i.textContent=this.alt||"Image Preview",o.style.display="flex",document.body.style.overflow="hidden",e()}))})),s.addEventListener("click",(function(){o.style.display="none",document.body.style.overflow=""})),o.addEventListener("click",(function(e){e.target===o&&(o.style.display="none",document.body.style.overflow="")})),n.addEventListener("dblclick",(function(o){o.preventDefault(),1===u?u=2:e(),t()})),n.addEventListener("touchstart",(function(e){if(2===e.touches.length){const t=e.touches[0],o=e.touches[1],n=Math.hypot(o.clientX-t.clientX,o.clientY-t.clientY);this.dataset.initialDistance=n,this.dataset.initialScale=u}else 1===e.touches.length&&(l=e.touches[0].clientX-m,a=e.touches[0].clientY-h)})),n.addEventListener("touchmove",(function(e){if(e.preventDefault(),2===e.touches.length){const o=e.touches[0],n=e.touches[1],i=Math.hypot(n.clientX-o.clientX,n.clientY-o.clientY),s=parseFloat(this.dataset.initialDistance),c=parseFloat(this.dataset.initialScale);s&&c&&(u=c*(i/s),u=Math.min(Math.max(1,u),4),t())}else if(1===e.touches.length&&u>1){r=e.touches[0].clientX-l,d=e.touches[0].clientY-a;const o=(u-1)*n.width/2,i=(u-1)*n.height/2;m=Math.min(Math.max(r,-o),o),h=Math.min(Math.max(d,-i),i),t()}})),n.addEventListener("touchend",(function(){delete this.dataset.initialDistance,delete this.dataset.initialScale}))}function setActiveNavItem(){const e=document.querySelectorAll("#desktop-nav a");if(e&&e.length>0){e.forEach((e=>{e.classList.remove("active")}));const t=window.scrollY+100;document.querySelectorAll("section").forEach((e=>{const o=e.offsetTop,n=e.offsetHeight,i=e.querySelector(".section-anchor")?.id;i&&t>=o&&t<o+n&&(document.querySelector(`#desktop-nav a[href="#${i}"]`)?.classList.add("active"),document.querySelector(`.mobile-nav-sidebar a[href="#${i}"]`)?.classList.add("active"))}))}const t=document.querySelectorAll(".mobile-nav-sidebar a");if(t&&t.length>0){t.forEach((e=>{e.classList.remove("active")}));const e=window.scrollY+50;document.querySelectorAll("section").forEach((t=>{const o=t.offsetTop,n=t.offsetHeight,i=t.querySelector(".section-anchor")?.id;i&&e>=o&&e<o+n&&document.querySelector(`.mobile-nav-sidebar a[href="#${i}"]`)?.classList.add("active")}))}}function scrollFunction(){const e=document.getElementById("scroll-to-top");e&&(document.body.scrollTop>500||document.documentElement.scrollTop>500?(e.style.display="block",setTimeout((()=>{e.style.opacity="1"}),50)):(e.style.opacity="0",setTimeout((()=>{document.body.scrollTop<=500&&document.documentElement.scrollTop<=500&&(e.style.display="none")}),300)))}function updateReadingProgress(){const e=document.getElementById("reading-progress");if(!e)return;const t=window.innerHeight,o=document.documentElement.scrollHeight-t,n=window.scrollY/o*100;e.style.width=n+"%"}function initDesktopNavigation(e){e&&(e.forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault();const t=this.getAttribute("href").substring(1),o=document.getElementById(t);if(o){const e=80,t=o.getBoundingClientRect().top+window.pageYOffset-e;window.scrollTo({top:t,behavior:"smooth"})}}))})),setActiveNavItem(),window.addEventListener("scroll",debounce(setActiveNavItem,100)))}function initMobileNavigation(e,t,o,n){e&&t&&o&&(e.addEventListener("click",(function(){t.classList.toggle("active"),o.classList.toggle("active");const e=this.querySelector("i");e&&(t.classList.contains("active")?(e.classList.remove("fa-bars"),e.classList.add("fa-times")):(e.classList.remove("fa-times"),e.classList.add("fa-bars"))),t.classList.contains("active")?document.body.style.overflow="hidden":document.body.style.overflow=""})),o.addEventListener("click",(function(){t.classList.remove("active"),o.classList.remove("active"),document.body.style.overflow="";const n=e.querySelector("i");n&&(n.classList.remove("fa-times"),n.classList.add("fa-bars"))})),n&&n.forEach((n=>{n.addEventListener("click",(function(n){n.preventDefault();const i=this.getAttribute("href").substring(1),s=document.getElementById(i);if(s){const n=20,i=s.getBoundingClientRect().top+window.pageYOffset-n;window.scrollTo({top:i,behavior:"smooth"}),t.classList.remove("active"),o.classList.remove("active"),document.body.style.overflow="";const c=e.querySelector("i");c&&(c.classList.remove("fa-times"),c.classList.add("fa-bars"))}}))})),window.addEventListener("resize",(function(){if(window.innerWidth>=769&&t.classList.contains("active")){t.classList.remove("active"),o.classList.remove("active"),document.body.style.overflow="";const n=e.querySelector("i");n&&(n.classList.remove("fa-times"),n.classList.add("fa-bars"))}})))}function initBibtexCopy(e){e&&(e.addEventListener("click",(function(){const t=document.getElementById("bibtex-content");t&&navigator.clipboard.writeText(t.textContent).then((function(){const t=e.innerHTML;e.innerHTML='<i class="fas fa-check"></i> Copied!',e.classList.add("copy-button-success"),setTimeout((function(){e.innerHTML=t,e.classList.remove("copy-button-success")}),2e3)})).catch((function(){e.innerHTML='<i class="fas fa-times"></i> Failed!',e.classList.add("copy-button-error"),setTimeout((function(){e.innerHTML='<i class="fas fa-copy"></i> Copy',e.classList.remove("copy-button-error")}),2e3)}))})),e.addEventListener("mouseover",(function(){this.style.transform="translateY(-2px)",this.style.boxShadow="0 4px 10px rgba(106, 17, 203, 0.3)"})),e.addEventListener("mouseout",(function(){this.style.transform="translateY(0)",this.style.boxShadow="none"})))}function initScrollToTop(e){e&&(e.addEventListener("click",(function(){window.scrollTo({top:0,behavior:"smooth"})})),e.addEventListener("mouseover",(function(){this.classList.add("scroll-top-button-hover")})),e.addEventListener("mouseout",(function(){this.classList.remove("scroll-top-button-hover")})))}document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelectorAll("#desktop-nav a"),t=document.querySelectorAll(".mobile-nav-sidebar a"),o=document.getElementById("mobile-nav-toggle"),n=document.getElementById("mobile-nav-sidebar"),i=document.getElementById("mobile-nav-overlay"),s=document.getElementById("scroll-to-top"),c=document.getElementById("copy-bibtex");document.getElementById("theme-toggle");document.documentElement.classList.add("theme-initializing"),initThemeToggle(),setTimeout((()=>{document.documentElement.classList.remove("theme-initializing")}),300),document.querySelectorAll("em").forEach((e=>{e.classList.contains("highlight-text")||e.classList.add("highlight-text")})),initDesktopNavigation(e),initMobileNavigation(o,n,i,t),initBibtexCopy(c),initScrollToTop(s),window.addEventListener("scroll",debounce((function(){scrollFunction(),updateReadingProgress(),setActiveNavItem()}),10)),initializeLightbox(),scrollFunction(),updateReadingProgress(),setActiveNavItem(),document.addEventListener("keydown",(function(e){if("Escape"===e.key){if(n&&n.classList.contains("active")){n.classList.remove("active"),i.classList.remove("active"),document.body.style.overflow="";const e=o.querySelector("i");e&&(e.classList.remove("fa-times"),e.classList.add("fa-bars"))}const e=document.getElementById("lightbox");e&&"flex"===e.style.display&&(e.style.display="none",document.body.style.overflow="")}}))}));